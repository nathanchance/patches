From ff3c461ff8030b4f04583efed5af88f04bb5a9fb Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <nathan@kernel.org>
Date: Sun, 5 Feb 2023 12:08:57 -0700
Subject: [PATCH 8/8] HACK: CURRENT: infiniband: core: Work around KASAN +
 FORTIFY_SOURCE issue

Link: https://github.com/ClangBuiltLinux/linux/issues/1687
Signed-off-by: Nathan Chancellor <nathan@kernel.org>
---
 drivers/infiniband/core/cma.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/infiniband/core/cma.c b/drivers/infiniband/core/cma.c
index 8730674ceb2e..ca407df5ea7f 100644
--- a/drivers/infiniband/core/cma.c
+++ b/drivers/infiniband/core/cma.c
@@ -5157,8 +5157,10 @@ static int cma_netevent_callback(struct notifier_block *self,
 
 		neigh_sock_4.sin_family = AF_INET;
 		neigh_sock_4.sin_addr.s_addr = *(__be32 *)(neigh->primary_key);
+#ifndef CONFIG_COMPILE_TEST
 		ips_node = node_from_ndev_ip(&id_table, neigh->dev->ifindex,
 					     (struct sockaddr *)&neigh_sock_4);
+#endif
 	} else
 		goto out;
 
-- 
2.39.2


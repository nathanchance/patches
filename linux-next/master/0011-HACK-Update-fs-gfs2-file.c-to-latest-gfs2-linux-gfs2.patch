From 5a1107f4d8892583639e8c2e1bee79ea2d7c2d2b Mon Sep 17 00:00:00 2001
From: Nathan Chancellor <nathan@kernel.org>
Date: Thu, 17 Mar 2022 11:38:23 -0700
Subject: [PATCH 11/18] HACK: Update fs/gfs2/file.c to latest
 gfs2/linux-gfs2.git#for-next

Link: https://lore.kernel.org/r/202203170509.i1rWdOA0-lkp@intel.com/
Signed-off-by: Nathan Chancellor <nathan@kernel.org>
---
 fs/gfs2/file.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/fs/gfs2/file.c b/fs/gfs2/file.c
index a27fd293ccbe..9ab92088a9ba 100644
--- a/fs/gfs2/file.c
+++ b/fs/gfs2/file.c
@@ -787,13 +787,13 @@ static inline bool should_fault_in_pages(ssize_t ret, struct iov_iter *i,
 	size = PAGE_SIZE;
 	offs = offset_in_page(i->iov[0].iov_base + i->iov_offset);
 	if (*prev_count != count || !*window_size) {
-		int nr_dirtied;
+		size_t nr_dirtied;
 
 		size = ALIGN(offs + count, PAGE_SIZE);
 		size = min_t(size_t, size, SZ_1M);
 		nr_dirtied = max(current->nr_dirtied_pause -
 				 current->nr_dirtied, 8);
-		size = min(size, nr_dirtied * PAGE_SIZE);
+		size = min(size, nr_dirtied << PAGE_SHIFT);
 	}
 
 	*prev_count = count;
-- 
2.35.1

